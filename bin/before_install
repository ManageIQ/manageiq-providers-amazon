#!/bin/bash

# Ensure spec/manageiq is set up
gem_root="$(cd "$(dirname "${BASH_SOURCE[0]}")/.." &>/dev/null && pwd)"
spec_manageiq="$gem_root/spec/manageiq"

if [ -n "$MANAGEIQ_REPO" ]; then
  echo "== Symlinking spec/manageiq to $MANAGEIQ_REPO =="
  rm -rf "$spec_manageiq"
  ln -s "$(cd "$MANAGEIQ_REPO" &>/dev/null && pwd)" "$spec_manageiq"
elif [ ! -d "$spec_manageiq" ]; then
  echo "== Cloning manageiq sample app =="
  git clone https://github.com/ManageIQ/manageiq.git --branch master --depth 1 "$spec_manageiq"
fi
echo

# Run core's before_install
$spec_manageiq/bin/before_install
